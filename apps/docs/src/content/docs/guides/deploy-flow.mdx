---
title: Deploy Flow
description: Step-by-step guide to deploying your decentralized website using the Site Builder SDK deploy flow.
sidebar:
  order: 5
---

import { Tabs, TabItem } from '@astrojs/starlight/components';

The Site Builder SDK provides a comprehensive deployment flow that handles the entire process of deploying your website to Walrus + Sui networks. This guide walks you through each step of the deployment process, from asset preparation to site updates.

## Overview

The deployment flow consists of 4 main steps:

1. **Prepare Assets** - Register and validate your files
2. **Upload Assets** - Upload files to the Walrus network
3. **Certify Assets** - Certify uploaded files on-chain
4. **Update Site** - Create or update your site with the new assets

## Prerequisites

Before starting the deployment flow, ensure you have:

- **Wallet connected** - Sui wallet with sufficient funds
- **Files prepared** - Your website files in ZenFsFileManager
- **Network access** - Connection to Walrus and Sui networks
- **Gas budget** - Sui tokens for transaction fees

## Basic Setup

### 1. Initialize the SDK

```typescript
import { WalrusSiteBuilderSdk } from '@cmdoss/site-builder';
import { useSuiClient, useCurrentAccount, useSignAndExecuteTransaction } from '@mysten/dapp-kit';

function MyDeployComponent() {
  const suiClient = useSuiClient();
  const currentAccount = useCurrentAccount();
  const walrusClient = useWalrusClient();
  const { mutateAsync: signAndExecuteTransaction } = useSignAndExecuteTransaction();
  
  // Initialize SDK
  const sdk = new WalrusSiteBuilderSdk(
    walrusClient,
    suiClient,
    currentAccount,
    signAndExecuteTransaction,
    wallet
  );
}
```

### 2. Create Deploy Flow

```typescript
// Get your assets from file manager
const { assets } = useZenFsWorkspace('/workspace');

// Create deploy flow instance
const deployFlow = sdk.deployFlow(assets);
```

## Step-by-Step Deployment

### Step 1: Prepare Assets

The first step registers your files and validates them for deployment:

```typescript
const handlePrepareAssets = async () => {
  try {
    console.log('üöÄ Starting asset preparation...');
    await deployFlow.prepareAssets();
    console.log('‚úÖ Assets prepared successfully');
    
    // Get transaction details
    const transactions = deployFlow.getTransactions();
    console.log('Transactions:', transactions);
  } catch (error) {
    console.error('‚ùå Asset preparation failed:', error);
  }
};
```

**What happens during preparation:**
- Files are validated and processed
- Asset metadata is generated
- Initial transaction is created
- Files are registered with the system

### Step 2: Upload Assets

Upload your prepared assets to the Walrus network:

<Tabs syncKey="upload-options">
<TabItem label="Basic Upload">

```typescript
const handleUploadAssets = async () => {
  try {
    console.log('üöÄ Starting asset upload...');
    
    // Upload with default settings (1 epoch, non-permanent)
    await deployFlow.uploadAssets(1, false);
    
    console.log('‚úÖ Assets uploaded successfully');
  } catch (error) {
    console.error('‚ùå Asset upload failed:', error);
  }
};
```

</TabItem>
<TabItem label="Custom Epoch">

```typescript
const handleUploadAssets = async () => {
  try {
    // Upload with custom epoch duration
    await deployFlow.uploadAssets(5, false); // 5 epochs
    console.log('‚úÖ Assets uploaded for 5 epochs');
  } catch (error) {
    console.error('‚ùå Upload failed:', error);
  }
};
```

</TabItem>
<TabItem label="Permanent Storage">

```typescript
const handleUploadAssets = async () => {
  try {
    // Upload with permanent storage
    await deployFlow.uploadAssets('max', true);
    console.log('‚úÖ Assets uploaded permanently');
  } catch (error) {
    console.error('‚ùå Upload failed:', error);
  }
};
```

</TabItem>
</Tabs>

**Upload Parameters:**
- **Epoch**: Storage duration (number or 'max')
- **Permanent**: Whether files should be stored permanently

### Step 3: Certify Assets

Certify your uploaded assets on the Sui blockchain:

```typescript
const handleCertifyAssets = async () => {
  try {
    console.log('üöÄ Starting asset certification...');
    
    const certifiedBlobs = await deployFlow.certifyAssets();
    
    console.log('‚úÖ Assets certified successfully');
    console.log('Certified blobs:', certifiedBlobs);
    
    // Each certified blob contains:
    // - blobId: Walrus blob identifier
    // - suiObjectId: Sui object identifier
    // - patchId: Quilt patch identifier
    // - identifier: File name/identifier
  } catch (error) {
    console.error('‚ùå Asset certification failed:', error);
  }
};
```

**Certification provides:**
- On-chain proof of file existence
- Immutable file references
- Integration with Sui blockchain

### Step 4: Update Site

Create or update your site with the certified assets:

```typescript
const handleUpdateSite = async () => {
  try {
    console.log('üöÄ Starting site update...');
    
    const siteId = await deployFlow.updateSite();
    
    if (siteId) {
      console.log('‚úÖ Site updated successfully');
      console.log('Site ID:', siteId);
      
      // Generate site URL
      const siteUrl = objectIdToWalrusSiteUrl(
        siteId, 
        'localhost:3000', // Portal host
        false             // HTTPS
      );
      console.log('Site URL:', siteUrl);
    }
  } catch (error) {
    console.error('‚ùå Site update failed:', error);
  }
};
```


## Complete React Hook Example

Here's how the playground implements the complete deploy flow:

```typescript
import { useDeployToWalrus } from '@/hooks/useDeployToWalrus';

export enum DeploySteps {
  Idle,
  Prepared,
  Uploaded,
  Certified,
  Deployed
}

function DeployComponent() {
  const { assets } = useZenFsWorkspace('/workspace');
  
  const {
    currentStep,
    certifiedBlobs,
    deployedSiteId,
    loading,
    handlePrepareAssets,
    handleUploadAssets,
    handleCertifyAssets,
    handleUpdateSite,
    handleCleanUp
  } = useDeployToWalrus(assets);

  return (
    <div className="deploy-section">
      <h2>Deploy Steps</h2>
      
      <div className="deploy-buttons">
        <button 
          onClick={handlePrepareAssets}
          disabled={currentStep !== DeploySteps.Idle || loading}
        >
          {currentStep <= DeploySteps.Idle ? '1. Register Blobs' : '‚úì Registered'}
        </button>
        
        <button 
          onClick={() => handleUploadAssets(1, false)}
          disabled={currentStep !== DeploySteps.Prepared || loading}
        >
          {currentStep <= DeploySteps.Prepared ? '2. Upload to Network' : '‚úì Uploaded'}
        </button>
        
        <button 
          onClick={handleCertifyAssets}
          disabled={currentStep !== DeploySteps.Uploaded || loading}
        >
          {currentStep <= DeploySteps.Uploaded ? '3. Certify Upload' : '‚úì Certified'}
        </button>
        
        <button 
          onClick={handleUpdateSite}
          disabled={currentStep !== DeploySteps.Certified || loading}
        >
          {currentStep <= DeploySteps.Certified ? '4. Update Site' : '‚úì Updated'}
        </button>
      </div>
      
      {deployedSiteId && (
        <div className="deployed-site">
          <h3>Deployed Site</h3>
          <p>Site ID: {deployedSiteId}</p>
          <a href={getSiteUrl(deployedSiteId)} target="_blank">
            Visit Site
          </a>
        </div>
      )}
    </div>
  );
}
```

## Next Steps
- Go to [example](/examples/) to see full flow